From beba58d724cc1bd7ca73660b0a5ad9e61ae0c562 Mon Sep 17 00:00:00 2001
From: "Zheng, Zhaoqiong" <zhaoqiong.zheng@intel.com>
Date: Fri, 27 Dec 2024 13:49:36 +0800
Subject: [PATCH 12/20] fix issue 142484

From https://github.com/pytorch/pytorch/pull/143894
---
 aten/src/ATen/native/mkl/SpectralOps.cpp | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/aten/src/ATen/native/mkl/SpectralOps.cpp b/aten/src/ATen/native/mkl/SpectralOps.cpp
index e26cfbf6d8e..c61b76d3205 100644
--- a/aten/src/ATen/native/mkl/SpectralOps.cpp
+++ b/aten/src/ATen/native/mkl/SpectralOps.cpp
@@ -477,7 +477,17 @@ static Tensor& _exec_fft(Tensor& out, const Tensor& self, IntArrayRef out_sizes,
 
   const auto value_type = c10::toRealValueType(input.scalar_type());
   out.resize_(batched_out_sizes, MemoryFormat::Contiguous);
-
+  auto astrides = input.strides();
+  bool all_zero = true;
+  for (const auto& stride : astrides) {
+      if (stride != 0) {
+          all_zero = false;
+          break;
+      }
+  }
+  if (all_zero) {
+      input = input.clone(MemoryFormat::Contiguous);
+  }
   auto descriptor = _plan_mkl_fft(
       input.strides(), out.strides(), signal_size, input.is_complex(),
       out.is_complex(), normalization, forward, value_type);
