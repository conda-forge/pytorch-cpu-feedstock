From 532682e899bed8cb97b922e0d1ff92664100e521 Mon Sep 17 00:00:00 2001
From: Jeongseok Lee <jeongseok@meta.com>
Date: Sun, 3 Nov 2024 01:12:36 -0700
Subject: [PATCH 02/13] Fix duplicate linker script

---
 setup.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/setup.py b/setup.py
index 11ca48482a7..1c5b75897df 100644
--- a/setup.py
+++ b/setup.py
@@ -1632,7 +1632,9 @@ def main() -> None:
             filein="cmake/prioritized_text.txt", fout="cmake/linker_script.ld"
         )
         linker_script_path = os.path.abspath("cmake/linker_script.ld")
-        os.environ["LDFLAGS"] = os.getenv("LDFLAGS", "") + f" -T{linker_script_path}"
+        ldflags = os.getenv("LDFLAGS", "")
+        if f"-T{linker_script_path}" not in ldflags:
+            os.environ["LDFLAGS"] = ldflags + f" -T{linker_script_path}"
         os.environ["CFLAGS"] = (
             os.getenv("CFLAGS", "") + " -ffunction-sections -fdata-sections"
         )
